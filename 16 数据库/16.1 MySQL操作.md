### 16.1 MySQL操作

Go语言标准库中没有数据库驱动。

获取第三方驱动，请参考： [https://github.com/golang/go/wiki/SQLDrivers](https://github.com/golang/go/wiki/SQLDrivers)

安装：

```bash
go get go get github.com/go-sql-driver/mysql
```

数据库结构：

**后续补充**

##### 16.1.1 打开数据库

```go
// Open opens a database specified by its database driver name and a
// driver-specific data source name, usually consisting of at least a
// database name and connection information.
//
// Most users will open a database via a driver-specific connection
// helper function that returns a *DB. No database drivers are included
// in the Go standard library. See https://golang.org/s/sqldrivers for
// a list of third-party drivers.
//
// Open may just validate its arguments without creating a connection
// to the database. To verify that the data source name is valid, call
// Ping.
//
// The returned DB is safe for concurrent use by multiple goroutines
// and maintains its own pool of idle connections. Thus, the Open
// function should be called just once. It is rarely necessary to
// close a DB.
func Open(driverName, dataSourceName string) (*DB, error)
```

Open打开一个dirverName指定的数据库，dataSourceName指定数据源，一般包至少括数据库文件名和（可能的）连接信息。

大多数用户会通过数据库特定的连接帮助函数打开数据库，返回一个\*DB。Go标准库中没有数据库驱动。参见[http://golang.org/s/sqldrivers](http://golang.org/s/sqldrivers)获取第三方驱动。

Open函数可能只是验证其参数，而不创建与数据库的连接。如果要检查数据源的名称是否合法，应调用返回值的Ping方法。

返回的DB可以安全的被多个go程同时使用，并会维护自身的闲置连接池。这样一来，Open函数只需调用一次。很少需要关闭DB。

```go
dsn := fmt.Sprintf("%s:%s@%s(%s:%s)/%s", USERNAME, PASSWORD, NETWORK, URL, PORT, DATABASE)
db, err := sql.Open("mysql", dsn)
if err != nil {
    fmt.Printf("Open mysql failed,err:%v\n", err)
    return
}
// 设置连接的最大时间量。
db.SetConnMaxLifetime(100 * time.Second)
// 设置与数据库建立连接的最大数目。
// 如果n大于0且小于最大闲置连接数，会将最大闲置连接数减小到匹配最大开启连接数的限制。
// 如果n <= 0，不会限制最大开启连接数，默认为0（无限制）。
db.SetMaxOpenConns(100)
db.SetMaxIdleConns(16)

fmt.Println("open mysql success. ")
```

##### 16.1.2 查询一行数据

```go
// QueryRow executes a query that is expected to return at most one row.
// QueryRow always returns a non-nil value. Errors are deferred until
// Row's Scan method is called.
// If the query selects no rows, the *Row's Scan will return ErrNoRows.
// Otherwise, the *Row's Scan scans the first selected row and discards
// the rest.
func (db *DB) QueryRow(query string, args ...interface{}) *Row
```

##### 16.1.3 查询数据

```go
// Query executes a query that returns rows, typically a SELECT.
// The args are for any placeholder parameters in the query.
func (db *DB) Query(query string, args ...interface{}) (*Rows, error
```

##### 16.1.4 插入一行数据

```go
// Exec executes a query without returning any rows.
// The args are for any placeholder parameters in the query.
func (db *DB) Exec(query string, args ...interface{}) (Result, error)
```

##### 16.1.5 修改数据

```go
// Exec executes a query without returning any rows.
// The args are for any placeholder parameters in the query.
func (db *DB) Exec(query string, args ...interface{}) (Result, error)
```

##### 16.1.6 删除数据

```go
// Exec executes a query without returning any rows.
// The args are for any placeholder parameters in the query.
func (db *DB) Exec(query string, args ...interface{}) (Result, error)
```



